<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.aloha.zootopia.mapper.PostCommentMapper">

  <resultMap id="PostCommentMap" type="com.aloha.zootopia.domain.PostComment">
    <id property="commentId" column="comment_id" />
    <result property="content" column="content" />
    <result property="createdAt" column="created_at" />
    <result property="updatedAt" column="updated_at" />
    <result property="isDeleted" column="is_deleted" />
    <result property="userId" column="user_id" />
    <result property="postId" column="post_id" />
  </resultMap>

  <!-- 댓글 목록 -->
  <select id="findByPostId" resultMap="PostCommentMap">
    SELECT * FROM post_comments
    WHERE post_id = #{postId}
    AND (is_deleted IS NULL OR is_deleted = FALSE)
    ORDER BY comment_id ASC
  </select>

  <!-- 단건 조회 -->
  <select id="selectById" resultMap="PostCommentMap">
    SELECT * FROM post_comments
    WHERE comment_id = #{commentId}
  </select>

  <!-- 등록 -->
  <insert id="insert" useGeneratedKeys="true" keyProperty="commentId">
    INSERT INTO post_comments (content, created_at, user_id, post_id)
    VALUES (#{content}, NOW(), #{userId}, #{postId})
  </insert>

  <!-- 수정 -->
  <update id="update">
    UPDATE post_comments
    SET content = #{content},
        updated_at = NOW()
    WHERE comment_id = #{commentId}
  </update>

  <!-- 삭제 (soft delete) -->
  <update id="delete">
    UPDATE post_comments
    SET is_deleted = TRUE
    WHERE comment_id = #{commentId}
  </update>

</mapper>
