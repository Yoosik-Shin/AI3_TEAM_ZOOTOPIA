{
    "sourceFile": "ZOOTOPIA/src/main/resources/templates/service/hospital/details.html",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1752333084438,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752333123380,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -323,6 +323,7 @@\n             }\r\n         }\r\n     </script>\r\n     <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js\" integrity=\"sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q\" crossorigin=\"anonymous\"></script>\r\n+    <script th:src=\"@{/assets/dist/js/header.js}\"></script>\r\n </body>\r\n </html>\n\\ No newline at end of file\n"
                }
            ],
            "date": 1752333084438,
            "name": "Commit-0",
            "content": "<!DOCTYPE html>\r\n<html lang=\"ko\" xmlns:th=\"http://www.thymeleaf.org\" xmlns:sec=\"http://www.thymeleaf.org/thymeleaf-extras-springsecurity5\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>병원 상세</title>\r\n    <!-- CSRF Token -->\r\n    <meta name=\"_csrf\" th:content=\"${_csrf.token}\" />\r\n    <meta name=\"_csrf_header\" th:content=\"${_csrf.headerName}\" />\r\n    <!-- Bootstrap CSS -->\r\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\" integrity=\"sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH\" crossorigin=\"anonymous\">\r\n    <!-- Font Awesome CSS -->\r\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css\">\r\n    <link rel=\"stylesheet\" th:href=\"@{/css/hospital_style.css}\">\r\n    <link rel=\"stylesheet\" th:href=\"@{/assets/dist/css/header.css}\">\r\n</head>\r\n<body>\r\n    <th:block th:replace=\"~{/fragments/header :: header}\"></th:block>\r\n    <div class=\"hospital-main-container\">\r\n        <!-- 상단 로고 -->\r\n        <div class=\"logo-container\">\r\n            <div class=\"logo\">\r\n                <img th:src=\"@{/img/hosp_logo.png}\" alt=\"병원 아이콘\" class=\"logo-icon\">\r\n            </div>\r\n        </div>\r\n\r\n        <!-- 동물 배너 -->\r\n        <div class=\"animal-banner\">\r\n            <div class=\"animal-icons\">\r\n                <span class=\"animal-icon\">🐱</span>\r\n                <span class=\"animal-icon\">🐶</span>\r\n                <span class=\"animal-icon\">🐸</span>\r\n                <span class=\"text\">병원 소개</span>\r\n                <span class=\"animal-icon\">🦜</span>\r\n                <span class=\"animal-icon\">🐹</span>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- 메인 컨텐츠 -->\r\n        <div class=\"main-content\">\r\n            <div class=\"detail-container\">\r\n                <div class=\"hospital-image-section\">\r\n                    <img th:with=\"imageUrl=${(hospital.thumbnailImageUrl != null and hospital.thumbnailImageUrl != '') ? hospital.thumbnailImageUrl : '/img/default-hospital.png'}\"\r\n                         th:src=\"@{${imageUrl}}\" alt=\"병원 이미지\" class=\"hospital-image\">\r\n                    <!-- <img src=\"hospital-building.jpg\" alt=\"병원 건물\" class=\"hospital-image\"> -->\r\n                </div>\r\n\r\n                <div class=\"hospital-info-section\">\r\n                    <table class=\"info-table\">\r\n                        <tr>\r\n                            <td class=\"info-label\">병원 이름</td>\r\n                            <td class=\"info-value\" th:text=\"${hospital.name}\">아크리스 특수동물 병원</td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class=\"info-label\">진료 과목</td>\r\n                            <td class=\"info-value\">\r\n                                <span th:each=\"spec : ${hospital.specialties}\" th:text=\"${spec.category} + ' '\">치과, 외과, 내과, 건강검진</span>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class=\"info-label\">진료 가능 동물</td>\r\n                            <td class=\"info-value\">\r\n                                <span th:each=\"animal : ${hospital.animals}\" th:text=\"${animal.species} + ' '\">포유류, 파충류, 조류, 설치류</span>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class=\"info-label\">병원 주소</td>\r\n                            <td class=\"info-value\" th:text=\"${hospital.address}\">서울특별시 강남구 영은사로 104길 10 동화빌딩 3층</td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class=\"info-label\">홈페이지</td>\r\n                            <td class=\"info-value\">\r\n                                <a th:href=\"${hospital.homepage}\" th:text=\"${hospital.homepage}\">https://acrisamc.co.kr/</a>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class=\"info-label\">대표번호</td>\r\n                            <td class=\"info-value\" th:text=\"${hospital.phone}\">02-583-7582</td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class=\"info-label\">이메일</td>\r\n                            <td class=\"info-value\" th:text=\"${hospital.email}\">X</td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class=\"info-label\">병원 소개</td>\r\n                            <td class=\"info-value\" th:text=\"${hospital.hospIntroduce}\">X</td>\r\n                        </tr>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- 관리자용 버튼 -->\r\n            <div class=\"mb-3\" style=\"text-align: right; margin-top: 20px;\" sec:authorize=\"hasAuthority('ROLE_ADMIN')\">\r\n                <a th:href=\"@{/hospitals/edit/{id}(id=${hospital.hospitalId})}\" class=\"btn btn-primary\">수정하기</a>\r\n            </div>\r\n\r\n            <!-- 병원 리뷰 섹션 -->\r\n            <div class=\"review-section\">\r\n                <div class=\"review-header\">\r\n                    <h3>이 병원 어때요?</h3>\r\n                    <span id=\"review-count\" style=\"margin-left: 10px; font-size: 0.9em; color: gray;\"></span>\r\n                </div>\r\n\r\n                <!-- 리뷰 목록 -->\r\n                <div id=\"review-list\" class=\"review-list\">\r\n                    <!-- 리뷰가 동적으로 여기에 추가됩니다. -->\r\n                </div>\r\n\r\n                <!-- 리뷰 작성 폼 (로그인한 사용자에게만 표시) -->\r\n                <div id=\"review-form-container\" sec:authorize=\"isAuthenticated()\">\r\n                    <h4>리뷰 작성</h4>\r\n                    <form id=\"review-form\" class=\"review-form\">\r\n                        <input type=\"hidden\" id=\"reviewId\" name=\"reviewId\">\r\n                        <div class=\"rating\">\r\n                            <span class=\"star\" data-value=\"1\">★</span>\r\n                            <span class=\"star\" data-value=\"2\">★</span>\r\n                            <span class=\"star\" data-value=\"3\">★</span>\r\n                            <span class=\"star\" data-value=\"4\">★</span>\r\n                            <span class=\"star\" data-value=\"5\">★</span>\r\n                        </div>\r\n                        <input type=\"hidden\" id=\"rating\" name=\"rating\" value=\"0\">\r\n                        <div class=\"review-input-container\">\r\n                            <textarea id=\"content\" name=\"content\" class=\"review-input\" placeholder=\"리뷰를 작성해주세요.\" required></textarea>\r\n                            <button type=\"submit\" class=\"review-submit-btn\">등록</button>\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n            </div>\r\n\r\n    </div>\r\n</div>\r\n    <th:block th:replace=\"~{/fragments/footer :: footer}\"></th:block>\r\n\r\n    <script th:inline=\"javascript\">\r\n        const hospitalId = /*[[${hospital.hospitalId}]]*/ 0;\r\n        const currentUserId = /*[[${#authentication.principal != 'anonymousUser' and #authentication.principal.user != null ? #authentication.principal.user.userId : null}]]*/ null;\r\n\r\n        document.addEventListener('DOMContentLoaded', () => {\r\n            loadReviews();\r\n\r\n            // 로그인한 경우에만 별점 및 폼 제출 이벤트 설정\r\n            if (document.getElementById('review-form-container')) {\r\n                setupStarRating();\r\n                handleFormSubmit();\r\n            }\r\n        });\r\n\r\n        // 리뷰 목록 로드\r\n        async function loadReviews() {\r\n            try {\r\n                const response = await fetch(`/hospitals/${hospitalId}/reviews`);\r\n                if (!response.ok) throw new Error('리뷰를 불러오는데 실패했습니다.');\r\n\r\n                const reviews = await response.json();\r\n                const reviewList = document.getElementById('review-list');\r\n                reviewList.innerHTML = '';\r\n\r\n                // 리뷰 개수 업데이트\r\n                const reviewCountSpan = document.getElementById('review-count');\r\n                if (reviewCountSpan) {\r\n                    reviewCountSpan.textContent = `등록된 리뷰 : (${reviews.length}개)`;\r\n                }\r\n\r\n                reviews.forEach(review => {\r\n                    const reviewElement = document.createElement('div');\r\n                    reviewElement.classList.add('review-item');\r\n                    reviewElement.dataset.reviewId = review.reviewId;\r\n\r\n                    const editDeleteButtons = currentUserId === review.userId\r\n                        ? `<div class=\"review-update-container\">\r\n                               <button onclick=\"editReview(${review.reviewId}, ${review.rating}, '${review.content}')\">수정</button>\r\n                               <button onclick=\"deleteReview(${review.reviewId})\">삭제</button>\r\n                           </div>`\r\n                        : '';\r\n\r\n                    reviewElement.innerHTML = `\r\n                        <div class=\"review-rating\">\r\n                            <div class=\"author-rating\">\r\n                                <strong class=\"review-author\">${review.userNickname}</strong>\r\n                                <div class=\"star-rating\"></div>\r\n                            </div>\r\n                            ${editDeleteButtons}\r\n                        </div>\r\n                        <div class=\"review-date-container\">\r\n                            <span class=\"review-date\">${new Date(review.createdAt).toLocaleString('ko-KR', {\r\n                                                                                                            year: '2-digit',\r\n                                                                                                            month: '2-digit',\r\n                                                                                                            day: '2-digit',\r\n                                                                                                            hour: '2-digit',\r\n                                                                                                            minute: '2-digit',\r\n                                                                                                            second: '2-digit'\r\n                                                                                                        })}</span>\r\n                        </div>\r\n                        <hr class=\"border border-1 opacity-50\">\r\n                        <p class=\"review-content\">${review.content}</p>\r\n                    `;\r\n\r\n                    // 별점 표시\r\n                    const starRating = reviewElement.querySelector('.star-rating');\r\n                    for (let i = 1; i <= 5; i++) {\r\n                        starRating.innerHTML += i <= review.rating ? '★' : '☆';\r\n                    }\r\n\r\n                    reviewList.appendChild(reviewElement);\r\n                });\r\n            } catch (error) {\r\n                console.error('Error loading reviews:', error);\r\n                const reviewList = document.getElementById('review-list');\r\n                reviewList.innerHTML = '<p>리뷰를 불러오는 중 오류가 발생했습니다.</p>';\r\n            }\r\n        }\r\n\r\n        // 별점 처리 설정\r\n        function setupStarRating() {\r\n            const stars = document.querySelectorAll('#review-form .rating .star');\r\n            const ratingInput = document.getElementById('rating');\r\n\r\n            stars.forEach(star => {\r\n                star.addEventListener('click', () => {\r\n                    const value = star.getAttribute('data-value');\r\n                    ratingInput.value = value;\r\n                    stars.forEach(s => {\r\n                        s.classList.toggle('selected', s.getAttribute('data-value') <= value);\r\n                    });\r\n                });\r\n            });\r\n        }\r\n\r\n        // 리뷰 폼 제출 처리\r\n        function handleFormSubmit() {\r\n            const form = document.getElementById('review-form');\r\n            form.addEventListener('submit', async (e) => {\r\n                e.preventDefault();\r\n\r\n                const rating = document.getElementById('rating').value;\r\n                const content = document.getElementById('content').value.trim();\r\n                const reviewId = document.getElementById('reviewId').value;\r\n\r\n                if (rating === '0' || content === '') {\r\n                    alert('별점과 리뷰 내용을 모두 입력해주세요.');\r\n                    return;\r\n                }\r\n\r\n                const url = reviewId\r\n                    ? `/hospitals/${hospitalId}/reviews/${reviewId}`\r\n                    : `/hospitals/${hospitalId}/reviews`;\r\n                const method = reviewId ? 'PUT' : 'POST';\r\n\r\n                // CSRF 토큰 가져오기\r\n                const csrfToken = document.querySelector('meta[name=\"_csrf\"]').getAttribute('content');\r\n                const csrfHeader = document.querySelector('meta[name=\"_csrf_header\"]').getAttribute('content');\r\n\r\n                try {\r\n                    const response = await fetch(url, {\r\n                        method: method,\r\n                        headers: {\r\n                            'Content-Type': 'application/json',\r\n                            [csrfHeader]: csrfToken // CSRF 토큰 추가\r\n                        },\r\n                        body: JSON.stringify({ hospitalId: hospitalId, rating: parseInt(rating), content: content }),\r\n                    });\r\n\r\n                    if (response.ok) {\r\n                        loadReviews();\r\n                        form.reset();\r\n                        document.getElementById('reviewId').value = '';\r\n                        document.querySelectorAll('#review-form .rating .star').forEach(s => s.classList.remove('selected'));\r\n                        document.querySelector('#review-form button[type=\"submit\"]').textContent = '등록';\r\n                    } else {\r\n                        const errorText = await response.text();\r\n                        alert(`리뷰 처리에 실패했습니다: ${errorText}`);\r\n                    }\r\n                } catch (error) {\r\n                    console.error('Error submitting review:', error);\r\n                    alert('리뷰 처리 중 오류가 발생했습니다.');\r\n                }\r\n            });\r\n        }\r\n\r\n        // 리뷰 수정 폼 채우기\r\n        function editReview(id, rating, content) {\r\n            document.getElementById('reviewId').value = id;\r\n            document.getElementById('rating').value = rating;\r\n            document.getElementById('content').value = content;\r\n\r\n            // 별점 시각적으로 업데이트\r\n            const stars = document.querySelectorAll('#review-form .rating .star');\r\n            stars.forEach(s => {\r\n                s.classList.toggle('selected', s.getAttribute('data-value') <= rating);\r\n            });\r\n\r\n            document.querySelector('#review-form button[type=\"submit\"]').textContent = '수정';\r\n            document.getElementById('review-form-container').scrollIntoView({ behavior: 'smooth' });\r\n        }\r\n\r\n        // 리뷰 삭제\r\n        async function deleteReview(id) {\r\n            if (!confirm('정말로 이 리뷰를 삭제하시겠습니까?')) {\r\n                return;\r\n            }\r\n\r\n            // CSRF 토큰 가져오기\r\n            const csrfToken = document.querySelector('meta[name=\"_csrf\"]').getAttribute('content');\r\n            const csrfHeader = document.querySelector('meta[name=\"_csrf_header\"]').getAttribute('content');\r\n\r\n            try {\r\n                const response = await fetch(`/hospitals/${hospitalId}/reviews/${id}`, {\r\n                    method: 'DELETE',\r\n                    headers: {\r\n                        [csrfHeader]: csrfToken // CSRF 토큰 추가\r\n                    }\r\n                });\r\n\r\n                if (response.ok) {\r\n                    loadReviews();\r\n                } else {\r\n                    const errorText = await response.text();\r\n                    alert(`리뷰 삭제에 실패했습니다: ${errorText}`);\r\n                }\r\n            } catch (error) {\r\n                console.error('Error deleting review:', error);\r\n                alert('리뷰 삭제 중 오류가 발생했습니다.');\r\n            }\r\n        }\r\n    </script>\r\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js\" integrity=\"sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q\" crossorigin=\"anonymous\"></script>\r\n</body>\r\n</html>"
        }
    ]
}