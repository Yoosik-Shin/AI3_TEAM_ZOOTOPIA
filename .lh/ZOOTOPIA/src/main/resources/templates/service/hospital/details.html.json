{
    "sourceFile": "ZOOTOPIA/src/main/resources/templates/service/hospital/details.html",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1752333084438,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752333123380,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -323,6 +323,7 @@\n             }\r\n         }\r\n     </script>\r\n     <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js\" integrity=\"sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q\" crossorigin=\"anonymous\"></script>\r\n+    <script th:src=\"@{/assets/dist/js/header.js}\"></script>\r\n </body>\r\n </html>\n\\ No newline at end of file\n"
                }
            ],
            "date": 1752333084438,
            "name": "Commit-0",
            "content": "<!DOCTYPE html>\r\n<html lang=\"ko\" xmlns:th=\"http://www.thymeleaf.org\" xmlns:sec=\"http://www.thymeleaf.org/thymeleaf-extras-springsecurity5\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>ë³‘ì› ìƒì„¸</title>\r\n    <!-- CSRF Token -->\r\n    <meta name=\"_csrf\" th:content=\"${_csrf.token}\" />\r\n    <meta name=\"_csrf_header\" th:content=\"${_csrf.headerName}\" />\r\n    <!-- Bootstrap CSS -->\r\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\" integrity=\"sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH\" crossorigin=\"anonymous\">\r\n    <!-- Font Awesome CSS -->\r\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css\">\r\n    <link rel=\"stylesheet\" th:href=\"@{/css/hospital_style.css}\">\r\n    <link rel=\"stylesheet\" th:href=\"@{/assets/dist/css/header.css}\">\r\n</head>\r\n<body>\r\n    <th:block th:replace=\"~{/fragments/header :: header}\"></th:block>\r\n    <div class=\"hospital-main-container\">\r\n        <!-- ìƒë‹¨ ë¡œê³  -->\r\n        <div class=\"logo-container\">\r\n            <div class=\"logo\">\r\n                <img th:src=\"@{/img/hosp_logo.png}\" alt=\"ë³‘ì› ì•„ì´ì½˜\" class=\"logo-icon\">\r\n            </div>\r\n        </div>\r\n\r\n        <!-- ë™ë¬¼ ë°°ë„ˆ -->\r\n        <div class=\"animal-banner\">\r\n            <div class=\"animal-icons\">\r\n                <span class=\"animal-icon\">ğŸ±</span>\r\n                <span class=\"animal-icon\">ğŸ¶</span>\r\n                <span class=\"animal-icon\">ğŸ¸</span>\r\n                <span class=\"text\">ë³‘ì› ì†Œê°œ</span>\r\n                <span class=\"animal-icon\">ğŸ¦œ</span>\r\n                <span class=\"animal-icon\">ğŸ¹</span>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- ë©”ì¸ ì»¨í…ì¸  -->\r\n        <div class=\"main-content\">\r\n            <div class=\"detail-container\">\r\n                <div class=\"hospital-image-section\">\r\n                    <img th:with=\"imageUrl=${(hospital.thumbnailImageUrl != null and hospital.thumbnailImageUrl != '') ? hospital.thumbnailImageUrl : '/img/default-hospital.png'}\"\r\n                         th:src=\"@{${imageUrl}}\" alt=\"ë³‘ì› ì´ë¯¸ì§€\" class=\"hospital-image\">\r\n                    <!-- <img src=\"hospital-building.jpg\" alt=\"ë³‘ì› ê±´ë¬¼\" class=\"hospital-image\"> -->\r\n                </div>\r\n\r\n                <div class=\"hospital-info-section\">\r\n                    <table class=\"info-table\">\r\n                        <tr>\r\n                            <td class=\"info-label\">ë³‘ì› ì´ë¦„</td>\r\n                            <td class=\"info-value\" th:text=\"${hospital.name}\">ì•„í¬ë¦¬ìŠ¤ íŠ¹ìˆ˜ë™ë¬¼ ë³‘ì›</td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class=\"info-label\">ì§„ë£Œ ê³¼ëª©</td>\r\n                            <td class=\"info-value\">\r\n                                <span th:each=\"spec : ${hospital.specialties}\" th:text=\"${spec.category} + ' '\">ì¹˜ê³¼, ì™¸ê³¼, ë‚´ê³¼, ê±´ê°•ê²€ì§„</span>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class=\"info-label\">ì§„ë£Œ ê°€ëŠ¥ ë™ë¬¼</td>\r\n                            <td class=\"info-value\">\r\n                                <span th:each=\"animal : ${hospital.animals}\" th:text=\"${animal.species} + ' '\">í¬ìœ ë¥˜, íŒŒì¶©ë¥˜, ì¡°ë¥˜, ì„¤ì¹˜ë¥˜</span>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class=\"info-label\">ë³‘ì› ì£¼ì†Œ</td>\r\n                            <td class=\"info-value\" th:text=\"${hospital.address}\">ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ì˜ì€ì‚¬ë¡œ 104ê¸¸ 10 ë™í™”ë¹Œë”© 3ì¸µ</td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class=\"info-label\">í™ˆí˜ì´ì§€</td>\r\n                            <td class=\"info-value\">\r\n                                <a th:href=\"${hospital.homepage}\" th:text=\"${hospital.homepage}\">https://acrisamc.co.kr/</a>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class=\"info-label\">ëŒ€í‘œë²ˆí˜¸</td>\r\n                            <td class=\"info-value\" th:text=\"${hospital.phone}\">02-583-7582</td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class=\"info-label\">ì´ë©”ì¼</td>\r\n                            <td class=\"info-value\" th:text=\"${hospital.email}\">X</td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class=\"info-label\">ë³‘ì› ì†Œê°œ</td>\r\n                            <td class=\"info-value\" th:text=\"${hospital.hospIntroduce}\">X</td>\r\n                        </tr>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- ê´€ë¦¬ììš© ë²„íŠ¼ -->\r\n            <div class=\"mb-3\" style=\"text-align: right; margin-top: 20px;\" sec:authorize=\"hasAuthority('ROLE_ADMIN')\">\r\n                <a th:href=\"@{/hospitals/edit/{id}(id=${hospital.hospitalId})}\" class=\"btn btn-primary\">ìˆ˜ì •í•˜ê¸°</a>\r\n            </div>\r\n\r\n            <!-- ë³‘ì› ë¦¬ë·° ì„¹ì…˜ -->\r\n            <div class=\"review-section\">\r\n                <div class=\"review-header\">\r\n                    <h3>ì´ ë³‘ì› ì–´ë•Œìš”?</h3>\r\n                    <span id=\"review-count\" style=\"margin-left: 10px; font-size: 0.9em; color: gray;\"></span>\r\n                </div>\r\n\r\n                <!-- ë¦¬ë·° ëª©ë¡ -->\r\n                <div id=\"review-list\" class=\"review-list\">\r\n                    <!-- ë¦¬ë·°ê°€ ë™ì ìœ¼ë¡œ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤. -->\r\n                </div>\r\n\r\n                <!-- ë¦¬ë·° ì‘ì„± í¼ (ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì—ê²Œë§Œ í‘œì‹œ) -->\r\n                <div id=\"review-form-container\" sec:authorize=\"isAuthenticated()\">\r\n                    <h4>ë¦¬ë·° ì‘ì„±</h4>\r\n                    <form id=\"review-form\" class=\"review-form\">\r\n                        <input type=\"hidden\" id=\"reviewId\" name=\"reviewId\">\r\n                        <div class=\"rating\">\r\n                            <span class=\"star\" data-value=\"1\">â˜…</span>\r\n                            <span class=\"star\" data-value=\"2\">â˜…</span>\r\n                            <span class=\"star\" data-value=\"3\">â˜…</span>\r\n                            <span class=\"star\" data-value=\"4\">â˜…</span>\r\n                            <span class=\"star\" data-value=\"5\">â˜…</span>\r\n                        </div>\r\n                        <input type=\"hidden\" id=\"rating\" name=\"rating\" value=\"0\">\r\n                        <div class=\"review-input-container\">\r\n                            <textarea id=\"content\" name=\"content\" class=\"review-input\" placeholder=\"ë¦¬ë·°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.\" required></textarea>\r\n                            <button type=\"submit\" class=\"review-submit-btn\">ë“±ë¡</button>\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n            </div>\r\n\r\n    </div>\r\n</div>\r\n    <th:block th:replace=\"~{/fragments/footer :: footer}\"></th:block>\r\n\r\n    <script th:inline=\"javascript\">\r\n        const hospitalId = /*[[${hospital.hospitalId}]]*/ 0;\r\n        const currentUserId = /*[[${#authentication.principal != 'anonymousUser' and #authentication.principal.user != null ? #authentication.principal.user.userId : null}]]*/ null;\r\n\r\n        document.addEventListener('DOMContentLoaded', () => {\r\n            loadReviews();\r\n\r\n            // ë¡œê·¸ì¸í•œ ê²½ìš°ì—ë§Œ ë³„ì  ë° í¼ ì œì¶œ ì´ë²¤íŠ¸ ì„¤ì •\r\n            if (document.getElementById('review-form-container')) {\r\n                setupStarRating();\r\n                handleFormSubmit();\r\n            }\r\n        });\r\n\r\n        // ë¦¬ë·° ëª©ë¡ ë¡œë“œ\r\n        async function loadReviews() {\r\n            try {\r\n                const response = await fetch(`/hospitals/${hospitalId}/reviews`);\r\n                if (!response.ok) throw new Error('ë¦¬ë·°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\r\n\r\n                const reviews = await response.json();\r\n                const reviewList = document.getElementById('review-list');\r\n                reviewList.innerHTML = '';\r\n\r\n                // ë¦¬ë·° ê°œìˆ˜ ì—…ë°ì´íŠ¸\r\n                const reviewCountSpan = document.getElementById('review-count');\r\n                if (reviewCountSpan) {\r\n                    reviewCountSpan.textContent = `ë“±ë¡ëœ ë¦¬ë·° : (${reviews.length}ê°œ)`;\r\n                }\r\n\r\n                reviews.forEach(review => {\r\n                    const reviewElement = document.createElement('div');\r\n                    reviewElement.classList.add('review-item');\r\n                    reviewElement.dataset.reviewId = review.reviewId;\r\n\r\n                    const editDeleteButtons = currentUserId === review.userId\r\n                        ? `<div class=\"review-update-container\">\r\n                               <button onclick=\"editReview(${review.reviewId}, ${review.rating}, '${review.content}')\">ìˆ˜ì •</button>\r\n                               <button onclick=\"deleteReview(${review.reviewId})\">ì‚­ì œ</button>\r\n                           </div>`\r\n                        : '';\r\n\r\n                    reviewElement.innerHTML = `\r\n                        <div class=\"review-rating\">\r\n                            <div class=\"author-rating\">\r\n                                <strong class=\"review-author\">${review.userNickname}</strong>\r\n                                <div class=\"star-rating\"></div>\r\n                            </div>\r\n                            ${editDeleteButtons}\r\n                        </div>\r\n                        <div class=\"review-date-container\">\r\n                            <span class=\"review-date\">${new Date(review.createdAt).toLocaleString('ko-KR', {\r\n                                                                                                            year: '2-digit',\r\n                                                                                                            month: '2-digit',\r\n                                                                                                            day: '2-digit',\r\n                                                                                                            hour: '2-digit',\r\n                                                                                                            minute: '2-digit',\r\n                                                                                                            second: '2-digit'\r\n                                                                                                        })}</span>\r\n                        </div>\r\n                        <hr class=\"border border-1 opacity-50\">\r\n                        <p class=\"review-content\">${review.content}</p>\r\n                    `;\r\n\r\n                    // ë³„ì  í‘œì‹œ\r\n                    const starRating = reviewElement.querySelector('.star-rating');\r\n                    for (let i = 1; i <= 5; i++) {\r\n                        starRating.innerHTML += i <= review.rating ? 'â˜…' : 'â˜†';\r\n                    }\r\n\r\n                    reviewList.appendChild(reviewElement);\r\n                });\r\n            } catch (error) {\r\n                console.error('Error loading reviews:', error);\r\n                const reviewList = document.getElementById('review-list');\r\n                reviewList.innerHTML = '<p>ë¦¬ë·°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';\r\n            }\r\n        }\r\n\r\n        // ë³„ì  ì²˜ë¦¬ ì„¤ì •\r\n        function setupStarRating() {\r\n            const stars = document.querySelectorAll('#review-form .rating .star');\r\n            const ratingInput = document.getElementById('rating');\r\n\r\n            stars.forEach(star => {\r\n                star.addEventListener('click', () => {\r\n                    const value = star.getAttribute('data-value');\r\n                    ratingInput.value = value;\r\n                    stars.forEach(s => {\r\n                        s.classList.toggle('selected', s.getAttribute('data-value') <= value);\r\n                    });\r\n                });\r\n            });\r\n        }\r\n\r\n        // ë¦¬ë·° í¼ ì œì¶œ ì²˜ë¦¬\r\n        function handleFormSubmit() {\r\n            const form = document.getElementById('review-form');\r\n            form.addEventListener('submit', async (e) => {\r\n                e.preventDefault();\r\n\r\n                const rating = document.getElementById('rating').value;\r\n                const content = document.getElementById('content').value.trim();\r\n                const reviewId = document.getElementById('reviewId').value;\r\n\r\n                if (rating === '0' || content === '') {\r\n                    alert('ë³„ì ê³¼ ë¦¬ë·° ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');\r\n                    return;\r\n                }\r\n\r\n                const url = reviewId\r\n                    ? `/hospitals/${hospitalId}/reviews/${reviewId}`\r\n                    : `/hospitals/${hospitalId}/reviews`;\r\n                const method = reviewId ? 'PUT' : 'POST';\r\n\r\n                // CSRF í† í° ê°€ì ¸ì˜¤ê¸°\r\n                const csrfToken = document.querySelector('meta[name=\"_csrf\"]').getAttribute('content');\r\n                const csrfHeader = document.querySelector('meta[name=\"_csrf_header\"]').getAttribute('content');\r\n\r\n                try {\r\n                    const response = await fetch(url, {\r\n                        method: method,\r\n                        headers: {\r\n                            'Content-Type': 'application/json',\r\n                            [csrfHeader]: csrfToken // CSRF í† í° ì¶”ê°€\r\n                        },\r\n                        body: JSON.stringify({ hospitalId: hospitalId, rating: parseInt(rating), content: content }),\r\n                    });\r\n\r\n                    if (response.ok) {\r\n                        loadReviews();\r\n                        form.reset();\r\n                        document.getElementById('reviewId').value = '';\r\n                        document.querySelectorAll('#review-form .rating .star').forEach(s => s.classList.remove('selected'));\r\n                        document.querySelector('#review-form button[type=\"submit\"]').textContent = 'ë“±ë¡';\r\n                    } else {\r\n                        const errorText = await response.text();\r\n                        alert(`ë¦¬ë·° ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${errorText}`);\r\n                    }\r\n                } catch (error) {\r\n                    console.error('Error submitting review:', error);\r\n                    alert('ë¦¬ë·° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\r\n                }\r\n            });\r\n        }\r\n\r\n        // ë¦¬ë·° ìˆ˜ì • í¼ ì±„ìš°ê¸°\r\n        function editReview(id, rating, content) {\r\n            document.getElementById('reviewId').value = id;\r\n            document.getElementById('rating').value = rating;\r\n            document.getElementById('content').value = content;\r\n\r\n            // ë³„ì  ì‹œê°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸\r\n            const stars = document.querySelectorAll('#review-form .rating .star');\r\n            stars.forEach(s => {\r\n                s.classList.toggle('selected', s.getAttribute('data-value') <= rating);\r\n            });\r\n\r\n            document.querySelector('#review-form button[type=\"submit\"]').textContent = 'ìˆ˜ì •';\r\n            document.getElementById('review-form-container').scrollIntoView({ behavior: 'smooth' });\r\n        }\r\n\r\n        // ë¦¬ë·° ì‚­ì œ\r\n        async function deleteReview(id) {\r\n            if (!confirm('ì •ë§ë¡œ ì´ ë¦¬ë·°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {\r\n                return;\r\n            }\r\n\r\n            // CSRF í† í° ê°€ì ¸ì˜¤ê¸°\r\n            const csrfToken = document.querySelector('meta[name=\"_csrf\"]').getAttribute('content');\r\n            const csrfHeader = document.querySelector('meta[name=\"_csrf_header\"]').getAttribute('content');\r\n\r\n            try {\r\n                const response = await fetch(`/hospitals/${hospitalId}/reviews/${id}`, {\r\n                    method: 'DELETE',\r\n                    headers: {\r\n                        [csrfHeader]: csrfToken // CSRF í† í° ì¶”ê°€\r\n                    }\r\n                });\r\n\r\n                if (response.ok) {\r\n                    loadReviews();\r\n                } else {\r\n                    const errorText = await response.text();\r\n                    alert(`ë¦¬ë·° ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${errorText}`);\r\n                }\r\n            } catch (error) {\r\n                console.error('Error deleting review:', error);\r\n                alert('ë¦¬ë·° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\r\n            }\r\n        }\r\n    </script>\r\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js\" integrity=\"sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q\" crossorigin=\"anonymous\"></script>\r\n</body>\r\n</html>"
        }
    ]
}