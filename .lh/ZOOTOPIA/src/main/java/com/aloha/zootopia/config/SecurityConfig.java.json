{
    "sourceFile": "ZOOTOPIA/src/main/java/com/aloha/zootopia/config/SecurityConfig.java",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1751901075320,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1751903196796,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -51,8 +51,12 @@\n     // ğŸ” ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ì„¤ì • ë©”ì†Œë“œ\n \t@Bean\n     public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n \n+        // ë””ë²„ê¹… í™œì„±í™”\n+    6     http.debug(true);\n+\n+\n         // âœ… ì¸ê°€ ì„¤ì •\n \n         http.authorizeHttpRequests(auth -> auth\n                                 .requestMatchers(\"/admin\", \"/admin/**\").hasRole(\"ADMIN\")\n"
                },
                {
                    "date": 1751903349138,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -51,12 +51,8 @@\n     // ğŸ” ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ì„¤ì • ë©”ì†Œë“œ\n \t@Bean\n     public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n \n-        // ë””ë²„ê¹… í™œì„±í™”\n-    6     http.debug(true);\n-\n-\n         // âœ… ì¸ê°€ ì„¤ì •\n \n         http.authorizeHttpRequests(auth -> auth\n                                 .requestMatchers(\"/admin\", \"/admin/**\").hasRole(\"ADMIN\")\n"
                }
            ],
            "date": 1751901075320,
            "name": "Commit-0",
            "content": "package com.aloha.zootopia.config;\n\nimport javax.sql.DataSource;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.http.HttpMethod;\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;\nimport org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.security.web.authentication.rememberme.JdbcTokenRepositoryImpl;\nimport org.springframework.security.web.authentication.rememberme.PersistentTokenRepository;\n\nimport com.aloha.zootopia.security.CustomAccessDeniedHandler;\nimport com.aloha.zootopia.security.LoginFailureHandler;\nimport com.aloha.zootopia.security.LoginSuccessHandler;\nimport com.aloha.zootopia.service.UserDetailServiceImpl;\n\nimport lombok.extern.slf4j.Slf4j;\n\n@Slf4j\n@Configuration\n@EnableWebSecurity  // í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ì„¤ì • ë¹ˆìœ¼ë¡œ ë“±ë¡\n                    // @Secured / @PreAuthorized, @PostAuthorized ìœ¼ë¡œ ë©”ì„œë“œ ê¶Œí•œ ì œì–´ í™œì„±í™”\n@EnableMethodSecurity(securedEnabled = true, prePostEnabled = true)\npublic class SecurityConfig {\n\n    @Autowired\n    private DataSource dataSource;\n\n    // @Autowired\n    // private PasswordEncoder passwordEncoder;\n\n    @Autowired\n    private UserDetailServiceImpl userDetailServiceImpl;\n\n    @Autowired\n    private LoginSuccessHandler loginSuccessHandler;\n\n    @Autowired\n    private LoginFailureHandler loginFailureHandler;\n\n    @Autowired\n    private CustomAccessDeniedHandler customAccessDeniedHandler;\n\n\n    // ğŸ” ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ì„¤ì • ë©”ì†Œë“œ\n\t@Bean\n    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n\n        // âœ… ì¸ê°€ ì„¤ì •\n\n        http.authorizeHttpRequests(auth -> auth\n                                .requestMatchers(\"/admin\", \"/admin/**\").hasRole(\"ADMIN\")\n                                .requestMatchers(\"/user\", \"/user/**\").hasAnyRole(\"USER\",\"ADMIN\")\n                                .requestMatchers(\"/comments/add\").authenticated()\n                                .requestMatchers(\"/images/**\").permitAll()\n                                .requestMatchers(\"/hospitals\", \"/hospitals/detail/**\").permitAll()\n                                .anyRequest().permitAll()\n                                );\n\n\n\n\n        // ğŸ” í¼ ë¡œê·¸ì¸\n        // http.formLogin(login -> login.permitAll());\n\n        // âœ… ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ í˜ì´ì§€\n        http.formLogin(login -> login\n                                     .usernameParameter(\"email\")       // ì•„ì´ë”” íŒŒë¼ë¯¸í„°\n                                     //.passwordParameter(\"pw\")       // ë¹„ë°€ë²ˆí˜¸ íŒŒë¼ë¯¸í„°\n                                     .loginPage(\"/login\")                   // ë¡œê·¸ì¸ í˜ì´ì§€ ê²½ë¡œ\n                                     .loginProcessingUrl(\"/login\") // ë¡œê·¸ì¸ ìš”ì²­ ê²½ë¡œ\n                                     // .defaultSuccessUrl(\"/?=true\") // ë¡œê·¸ì¸ ì„±ê³µ ê²½ë¡œ\n                                     .successHandler(loginSuccessHandler)      // ë¡œê·¸ì¸ ì„±ê³µ í•¸ë“¤ëŸ¬ ì„¤ì •\n                                     .failureHandler(loginFailureHandler)      // ë¡œê·¸ì¸ ì‹¤íŒ¨ í•¸ë“¤ëŸ¬ ì„¤ì •\n\n                        );\n\n        http.exceptionHandling( exception -> exception\n                                            // ì˜ˆì™¸ ì²˜ë¦¬ í˜ì´ì§€ ì„¤ì •\n                                            // .accessDeniedPage(\"/exception\")\n                                            // ì ‘ê·¼ ê±°ë¶€ í•¸ë“¤ëŸ¬ ì„¤ì •\n                                            .accessDeniedHandler(customAccessDeniedHandler)\n\n                                );\n\n        // ğŸ‘©â€ğŸ’¼ ì‚¬ìš©ì ì •ì˜ ì¸ì¦\n        http.userDetailsService(userDetailServiceImpl);\n\n        // ğŸ”„ ìë™ ë¡œê·¸ì¸\n        http.rememberMe(me -> me\n                .key(\"aloha\")\n                .tokenRepository(tokenRepository())\n                .tokenValiditySeconds(60 * 60 * 24 * 7));\n\n        // ğŸ”“ ë¡œê·¸ì•„ì›ƒ ì„¤ì •\n        http.logout(logout -> logout\n                            .logoutUrl(\"/logout\")   // ë¡œê·¸ì•„ì›ƒ ìš”ì²­ ê²½ë¡œ\n                            .logoutSuccessUrl(\"/login?logout=true\") // ë¡œê·¸ì•„ì›ƒ ì„±ê³µ ì‹œ URL\n                            .invalidateHttpSession(true)        // ì„¸ì…˜ ì´ˆê¸°í™”\n                            .deleteCookies(\"remember-id\")       // ë¡œê·¸ì•„ì›ƒ ì‹œ, ì•„ì´ë””ì €ì¥ ì¿ í‚¤ ì‚­ì œ\n                            // .logoutSuccessHandler(null)         // ë¡œê·¸ì•„ì›ƒ ì„±ê³µ í•¸ë“¤ëŸ¬ ì„¤ì •\n                    );\n\n        return http.build();\n    }\n\n    // PersistentRepository í† í°ì •ë³´ ê°ì²´ - ë¹ˆ ë“±ë¡\n    @Bean\n    public PersistentTokenRepository tokenRepository() {\n        // JdbcTokenRepositoryImpl : í† í° ì €ì¥ ë°ì´í„° ë² ì´ìŠ¤ë¥¼ ë“±ë¡í•˜ëŠ” ê°ì²´\n        JdbcTokenRepositoryImpl repositoryImpl = new JdbcTokenRepositoryImpl();\n        // í† í° ì €ì¥ì†Œë¥¼ ì‚¬ìš©í•˜ëŠ” ë°ì´í„° ì†ŒìŠ¤ ì§€ì •\n        repositoryImpl.setDataSource(dataSource);\n        // persistent_logins í…Œì´ë¸” ìë™ ìƒì„±\n        // repositoryImpl.setCreateTableOnStartup(true);\n        try {\n            repositoryImpl.getJdbcTemplate().execute(JdbcTokenRepositoryImpl.CREATE_TABLE_SQL);\n        } catch (Exception e) {\n            log.error(\"persistent_logins í…Œì´ë¸”ì´ ì´ë¯¸ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.\");\n        }\n        return repositoryImpl;\n    }\n\n\n    // ğŸ‘®â€â™‚ï¸ğŸ”ì‚¬ìš©ì ì¸ì¦ ê´€ë¦¬ ë©”ì†Œë“œ\n    // ì¸ë©”ëª¨ë¦¬ ë°©ì‹ìœ¼ë¡œ ì¸ì¦\n    // @Bean\n    // public UserDetailsService userDetailsService() {\n    //     // user 123456\n    //     UserDetails user = User.builder()\n    //                             .username(\"user\")\n    //                             .password(passwordEncoder.encode(\"123456\"))\n    //                             .roles(\"USER\")\n    //                             .build();\n    //     // admin 123456\n    //     UserDetails admin = User.builder()\n    //                             .username(\"admin\")\n    //                             .password(passwordEncoder.encode(\"123456\"))\n    //                             .roles(\"USER\", \"ADMIN\")\n    //                             .build();\n\n    //     return new InMemoryUserDetailsManager( user, admin );\n    //     // return new JdbcUserDetailsManager( ... );\n    // }\n\n\n    /**\n     * ğŸƒ JDBC ì¸ì¦ ë°©ì‹ ë¹ˆ ë“±ë¡\n     * @return\n     */\n    // @Bean\n    // public UserDetailsService userDetailsService() {\n    //     JdbcUserDetailsManager userDetailsManager\n    //             = new JdbcUserDetailsManager(dataSource);\n\n    //     // ì‚¬ìš©ì ì¸ì¦ ì¿¼ë¦¬\n    //     String sql1 = \" SELECT username, password, enabled \"\n    //                 + \" FROM user \"\n    //                 + \" WHERE username = ? \"\n    //                 ;\n    //     // ì‚¬ìš©ì ê¶Œí•œ ì¿¼ë¦¬\n    //     String sql2 = \" SELECT username, auth \"\n    //                 + \" FROM user_auth \"\n    //                 + \" WHERE username = ? \"\n    //                 ;\n    //     userDetailsManager.setUsersByUsernameQuery(sql1);\n    //     userDetailsManager.setAuthoritiesByUsernameQuery(sql2);\n    //     return userDetailsManager;\n    // }\n\n\n    /**\n     * ğŸƒ AuthenticationManager ì¸ì¦ ê´€ë¦¬ì ë¹ˆ ë“±ë¡\n     * @param authenticationConfiguration\n     * @return\n     * @throws Exception\n    */\n    @Bean\n    public AuthenticationManager authenticationManager(\n                                    AuthenticationConfiguration authenticationConfiguration ) throws Exception {\n        return authenticationConfiguration.getAuthenticationManager();\n    }\n\n\n}\n"
        }
    ]
}